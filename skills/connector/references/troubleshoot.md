# 트러블슈팅 및 미해결 이슈 등록

스킬 진행 중 트러블슈팅이 **진전 없이 막혀있다고 판단**되면, GitHub 이슈 등록을 제안한다.

## 트리거 조건

단순 핑퐁 횟수가 아니라, **실제로 진전이 없는 상황**에서만 제안한다.

다음 조건 중 하나 이상을 만족해야 이슈 등록을 제안한다:
- **동일 에러 반복**: 같은 에러 메시지로 연결 테스트가 3회 이상 실패한 경우 (다른 조치를 시도했는데도 결과가 동일)
- **트러블슈팅 항목 소진**: 트러블슈팅 체크리스트(재시작, 토큰 확인, ID 확인, Bearer 형식, 네트워크 등)를 모두 확인했는데도 해결되지 않은 경우
- **사용자가 포기 의사 표현**: "안 되겠다", "모르겠다", "포기" 등 해결을 중단하려는 의사를 표현한 경우

다음 상황에서는 제안하지 **않는다**:
- 사용자가 새로운 시도를 하고 있는 중 (에러 메시지가 바뀌거나, 다른 단계를 진행 중)
- 토큰 재발급, 설정 수정 등 아직 시도하지 않은 조치가 남아있는 경우

## 이슈 등록 제안

AskUserQuestion으로 제안한다:
- question: "트러블슈팅을 시도했지만 문제가 계속되고 있습니다. GitHub에 이슈를 등록해서 추적할까요?"
- options: [
    {label: "네, 이슈 등록해주세요", description: "현재 상황과 환경 정보를 포함한 이슈를 자동으로 생성합니다"},
    {label: "아니요, 나중에 할게요", description: "이슈 등록 없이 진행합니다"}
  ]

## 이슈 생성

"네, 이슈 등록해주세요" 선택 시, `gh issue create` 명령으로 이슈를 생성한다.

이슈 저장소: `Bombay/smilegate-skills`

이슈 제목 형식:
```
[Connector] {서비스명} 연결 실패 — {에러 요약}
```

이슈 본문에 포함할 정보:

```markdown
## 증상
{어떤 서비스에서 어떤 문제가 발생했는지 1-2문장으로 요약}

## 에러 메시지
{연결 테스트 또는 설정 과정에서 발생한 실제 에러 메시지}

## 재현 과정
1. `/connector` 스킬 실행
2. {서비스명} 선택
3. 토큰 발급 및 입력 완료
4. Claude Code 재시작 후 연결 테스트
5. {어떤 에러가 발생했는지}

## 시도한 트러블슈팅
{사용자와 함께 시도한 해결 방법 목록}

## 환경 정보
- **OS**: {darwin/linux/windows + 버전}
- **Claude Code 버전**: {Bash로 `claude --version` 실행하여 확인}
- **네트워크**: {사내망/VPN/외부망 — 대화에서 파악된 정보}
- **설정 파일 경로**: {~/.claude.json 등}

## MCP 설정 (토큰 마스킹됨)
{해당 서비스의 mcpServers 설정을 출력하되, 토큰 값은 앞 6자만 남기고 `***`로 마스킹}

## 추가 컨텍스트
{대화 중 파악된 추가 정보가 있으면 기재}
```

**중요**:
- 이슈 본문에 토큰 전체를 절대 노출하지 않는다. 앞 6자 + `***` 형태로 마스킹한다.
- Bash로 `claude --version` 을 실행하여 Claude Code 버전을 수집한다.
- Bash로 `uname -a` 를 실행하여 OS 정보를 수집한다.
- `gh issue create` 명령 실행 전 수집한 정보를 사용자에게 보여주고 확인받는다.
- labels로 `bug`와 `connector`를 추가한다.

이슈 생성 명령:
```bash
gh issue create --repo Bombay/smilegate-skills \
  --title "{제목}" \
  --body "$(cat <<'EOF'
{본문}
EOF
)" \
  --label "bug,connector"
```

이슈 생성 후 URL을 사용자에게 보여준다:
"이슈가 등록되었습니다: {이슈 URL}"

이후 완료 리포트로 진행한다. (이슈 등록 여부와 관계없이 완료 리포트는 출력)

## 공통 트러블슈팅 체크리스트

연결 실패 시 확인할 것:
1. Claude Code를 재시작했는지 (설정 변경 후 재시작 필수)
2. 토큰이 올바르게 복사되었는지 (설정 파일에서 mcpServers 직접 확인)
3. 사용자 ID가 맞는지 (Jira/Confluence 프로필에서 확인)
4. BISKIT 토큰 앞에 "Bearer "가 포함되어 있는지 (공백 1개 필수)
5. 네트워크에서 mcp.sginfra.net 접근이 가능한지 (사내망 또는 VPN 필요)
6. Windows의 경우 %USERPROFILE%\.claude.json 경로가 맞는지 확인
